name: "CodeQL Advanced"

on:
  push:
    branches: [ "main", "develop" ]
  pull_request:
    branches: [ "main" ]
  schedule:
    - cron: '43 5 * * 2'

jobs:
  unit-tests:
    name: Unit Tests
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm install
      
    - name: Run Jest tests
      run: npm test

  analyze:
    name: Analyze (${{ matrix.language }})
    runs-on: ${{ (matrix.language == 'swift' && 'macos-latest') || 'ubuntu-latest' }}
    permissions:
      security-events: write
      packages: read
      actions: read
      contents: read
    
    needs: unit-tests

    strategy:
      fail-fast: false
      matrix:
        include:
        - language: javascript-typescript

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Initialize CodeQL
      uses: github/codeql-action/init@v4
      with:
        languages: ${{ matrix.language }}

    - name: Perform CodeQL Analysis
      uses: github/codeql-action/analyze@v4
      with:
        category: "/language:${{matrix.language}}"

  # JOB Ð”Ð›Ð¯ Ð”ÐžÐšÐ£ÐœÐ•ÐÐ¢ÐÐ¦Ð˜Ð˜ - ÐŸÐžÐ¡Ð›Ð• Ð’Ð¡Ð•Ð“Ðž
  documentation:
    name: Generate Documentation
    runs-on: ubuntu-latest
    # Ð—ÐÐ’Ð˜Ð¡Ð˜ÐœÐžÐ¡Ð¢Ð¬ ÐžÐ¢ Ð’Ð¡Ð•Ð¥ ÐŸÐ Ð•Ð”Ð«Ð”Ð£Ð©Ð˜Ð¥ JOBS
    needs: [unit-tests, analyze]
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: npm install
      
    - name: Generate JSDoc documentation
      run: npm run docs
      
    - name: Create simple README
      run: |
        cat > README.md << 'EOF'
        # Workday Checker Project
        
        ## ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ
        ÐŸÑ€Ð¾ÐµÐºÑ‚ Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÐµÐ¹ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ñ… Ð¸ Ð²Ñ‹Ñ…Ð¾Ð´Ð½Ñ‹Ñ… Ð´Ð½ÐµÐ¹.
        
        ## Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ checkWorkday()
        ```javascript
        // Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ true Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ñ… Ð´Ð½ÐµÐ¹, false Ð´Ð»Ñ Ð²Ñ‹Ñ…Ð¾Ð´Ð½Ñ‹Ñ…
        const result = checkWorkday();
        ```
        
        ## Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ
        - ÐŸÐ¾Ð»Ð½Ð°Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ: [docs/index.html](docs/index.html)
        - ÐÐ²Ñ‚Ð¾Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ ÐºÐ°Ð¶Ð´Ð¾Ð¼ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ðµ
        
        ## Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
        ```bash
        npm test          # Ð—Ð°Ð¿ÑƒÑÐº Ñ‚ÐµÑÑ‚Ð¾Ð²
        npm run test:watch # Ð¢ÐµÑÑ‚Ñ‹ Ð² watch mode
        ```
        
        ## Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ
        ```bash
        npm run docs        # Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸
        npm run docs:serve  # ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸
        ```
        
        ## CI Status
        ![CI](https://github.com/${{ github.repository }}/actions/workflows/${{ github.workflow }}.yml/badge.svg)
        
        *Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð°: $(date)*
        EOF
      
    - name: Upload documentation artifacts
      uses: actions/upload-artifact@v4
      with:
        name: documentation
        path: |
          README.md
          docs/
        retention-days: 30
      
    - name: Display completion message
      run: |
        echo "ðŸŽ‰ All jobs completed successfully!"
        echo "ðŸ“š Documentation generated in 'docs/' folder"
        echo "ðŸ“„ README.md updated"
